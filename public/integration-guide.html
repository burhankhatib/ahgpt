<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al Hayat GPT Widget Integration Guide</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        .container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            margin: 15px 0;
        }
        .example-title {
            color: #2b6cb0;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 10px;
        }
        .warning {
            background: #fef5e7;
            border: 1px solid #f6ad55;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        .success {
            background: #f0fff4;
            border: 1px solid #68d391;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        .error {
            background: #fed7d7;
            border: 1px solid #fc8181;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        .checklist {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 20px;
            margin: 15px 0;
        }
        .checklist ul {
            list-style: none;
            padding: 0;
        }
        .checklist li {
            padding: 8px 0;
            border-bottom: 1px solid #edf2f7;
        }
        .checklist li:before {
            content: "✓ ";
            color: #38a169;
            font-weight: bold;
        }
        h1 { color: #1a202c; }
        h2 { color: #2d3748; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; }
        h3 { color: #4a5568; }
    </style>
</head>
<body>
    <h1>🚀 Al Hayat GPT Widget Integration Guide</h1>
    <p>This guide shows you how to properly integrate the Al Hayat GPT widget into your website with robust error handling and loading patterns.</p>

    <div class="success">
        <strong>✅ Quick Test:</strong> You can test the widget on this page by opening the browser console and running the examples below.
    </div>

    <h2>1. Basic Integration</h2>
    
    <div class="example-title">Simple HTML Setup</div>
    <div class="code-block">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;My Website&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="chat-widget"&gt;&lt;/div&gt;
    
    &lt;script src="https://www.alhayatgpt.com/widget-sdk.min.js"&gt;&lt;/script&gt;
    &lt;script&gt;
        // Wait for SDK to load
        function initWidget() {
            if (typeof window.AlHayatGPT !== 'undefined') {
                const widget = AlHayatGPT.createWidget({
                    containerId: 'chat-widget',
                    theme: 'auto',
                    allowGuests: true
                });
            } else {
                console.error('Al Hayat GPT SDK not loaded');
            }
        }
        
        // Initialize after page load
        window.addEventListener('load', initWidget);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
    </div>

    <h2>2. Robust Integration with Retry Logic</h2>
    
    <div class="example-title">Recommended Pattern for Production</div>
    <div class="code-block">
&lt;script&gt;
class WidgetManager {
    constructor() {
        this.widget = null;
        this.maxRetries = 5;
        this.retryDelay = 1000; // 1 second
        this.retryCount = 0;
    }
    
    async initializeWidget() {
        try {
            await this.waitForSDK();
            
            this.widget = AlHayatGPT.createWidget({
                containerId: 'chat-widget',
                theme: 'auto',
                allowGuests: true,
                onReady: () => {
                    console.log('Widget ready!');
                },
                onError: (error) => {
                    console.error('Widget error:', error);
                }
            });
            
            console.log('Widget initialized successfully');
            
        } catch (error) {
            console.error('Failed to initialize widget:', error);
            this.showErrorMessage();
        }
    }
    
    waitForSDK() {
        return new Promise((resolve, reject) => {
            const checkSDK = () => {
                if (typeof window.AlHayatGPT !== 'undefined') {
                    resolve();
                } else if (this.retryCount >= this.maxRetries) {
                    reject(new Error('Max retries exceeded. SDK may not be loading properly.'));
                } else {
                    this.retryCount++;
                    console.log(\`Waiting for SDK... (attempt \${this.retryCount}/\${this.maxRetries})\`);
                    setTimeout(checkSDK, this.retryDelay);
                }
            };
            
            checkSDK();
        });
    }
    
    showErrorMessage() {
        const container = document.getElementById('chat-widget');
        if (container) {
            container.innerHTML = \`
                &lt;div style="padding: 20px; text-align: center; color: #dc3545;"&gt;
                    &lt;p&gt;Unable to load chat widget. Please refresh the page.&lt;/p&gt;
                    &lt;button onclick="location.reload()"&gt;Refresh&lt;/button&gt;
                &lt;/div&gt;
            \`;
        }
    }
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    const widgetManager = new WidgetManager();
    widgetManager.initializeWidget();
});
&lt;/script&gt;
    </div>

    <h2>3. Next.js / React Integration</h2>
    
    <div class="example-title">React Hook for Widget Management</div>
    <div class="code-block">
import { useEffect, useState, useRef } from 'react';

const useAlHayatGPTWidget = (containerId, config = {}) => {
    const [isLoaded, setIsLoaded] = useState(false);
    const [error, setError] = useState(null);
    const [widget, setWidget] = useState(null);
    const retryCount = useRef(0);
    const maxRetries = 5;

    useEffect(() => {
        const initializeWidget = async () => {
            try {
                // Wait for SDK to be available
                await waitForSDK();
                
                // Create widget
                const widgetInstance = window.AlHayatGPT.createWidget({
                    containerId,
                    theme: 'auto',
                    allowGuests: true,
                    ...config
                });
                
                setWidget(widgetInstance);
                setIsLoaded(true);
                
            } catch (err) {
                setError(err.message);
                console.error('Widget initialization failed:', err);
            }
        };

        const waitForSDK = () => {
            return new Promise((resolve, reject) => {
                const checkSDK = () => {
                    if (typeof window.AlHayatGPT !== 'undefined') {
                        resolve();
                    } else if (retryCount.current >= maxRetries) {
                        reject(new Error('Al Hayat GPT SDK methods not found'));
                    } else {
                        retryCount.current++;
                        setTimeout(checkSDK, 1000);
                    }
                };
                checkSDK();
            });
        };

        // Load script if not already loaded
        if (!document.querySelector('script[src*="widget-sdk"]')) {
            const script = document.createElement('script');
            script.src = 'https://www.alhayatgpt.com/widget-sdk.min.js';
            script.async = true;
            script.onload = initializeWidget;
            script.onerror = () => setError('Failed to load SDK script');
            document.head.appendChild(script);
        } else {
            initializeWidget();
        }

        // Cleanup
        return () => {
            if (widget) {
                widget.destroy();
            }
        };
    }, [containerId]);

    return { widget, isLoaded, error };
};

// Usage in component
const ChatWidget = () => {
    const { widget, isLoaded, error } = useAlHayatGPTWidget('chat-widget', {
        theme: 'auto',
        onReady: () => console.log('Widget ready!')
    });

    if (error) {
        return (
            &lt;div className="error"&gt;
                Error loading chat widget: {error}
            &lt;/div&gt;
        );
    }

    return (
        &lt;div&gt;
            {!isLoaded && &lt;div&gt;Loading chat widget...&lt;/div&gt;}
            &lt;div id="chat-widget" /&gt;
        &lt;/div&gt;
    );
};
    </div>

    <h2>4. Configuration Options</h2>
    
    <div class="container">
        <div class="example-title">Complete Configuration Example</div>
        <div class="code-block">
const widget = AlHayatGPT.createWidget({
    // Required
    containerId: 'chat-widget',
    
    // Optional authentication
    clerkPublishableKey: 'pk_test_your-key-here',
    
    // Appearance
    theme: 'auto', // 'light', 'dark', or 'auto'
    width: '100%',
    height: '600px',
    
    // Behavior
    allowGuests: true,
    
    // Custom styling
    customStyles: {
        borderRadius: '12px',
        boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
    },
    
    // Event callbacks
    onReady: () => {
        console.log('Widget is ready');
    },
    onUserSignIn: (user) => {
        console.log('User signed in:', user.firstName);
        // Track in your analytics
    },
    onUserSignOut: () => {
        console.log('User signed out');
    },
    onError: (error) => {
        console.error('Widget error:', error.message);
        // Handle error appropriately
    }
});
        </div>
    </div>

    <h2>5. Troubleshooting Common Issues</h2>
    
    <div class="checklist">
        <h3>Pre-flight Checklist</h3>
        <ul>
            <li>Verify the SDK script URL is correct and accessible</li>
            <li>Ensure the container element exists before initializing</li>
            <li>Check that your domain allows iframe embedding</li>
            <li>Verify HTTPS is used in production</li>
            <li>Check browser console for JavaScript errors</li>
        </ul>
    </div>

    <div class="error">
        <strong>Common Error:</strong> "Al Hayat GPT SDK methods not found"
        <br><br>
        <strong>Solutions:</strong>
        <ul>
            <li>Add retry logic to wait for SDK loading</li>
            <li>Use the <code>AlHayatGPTSDKReady</code> event</li>
            <li>Check if script is blocked by ad blockers</li>
            <li>Verify script loads successfully (check Network tab)</li>
        </ul>
    </div>

    <div class="warning">
        <strong>⚠️ Important:</strong> Always implement proper error handling and loading states for production use. The widget SDK loads asynchronously, so you need to wait for it to be available before initializing.
    </div>

    <h2>6. Live Testing</h2>
    
    <div class="container">
        <p>Test the SDK directly in your browser console:</p>
        <div class="code-block">
// Check if SDK is loaded
console.log('SDK loaded:', typeof window.AlHayatGPT !== 'undefined');

// Test widget creation (requires a div with id 'test-widget')
if (typeof window.AlHayatGPT !== 'undefined') {
    const testWidget = AlHayatGPT.createWidget({
        containerId: 'test-widget',
        theme: 'auto'
    });
}
        </div>
    </div>

    <!-- Load the actual SDK for testing -->
    <script src="./widget-sdk.min.js"></script>
    
    <!-- Test container -->
    <div style="margin: 20px 0;">
        <h3>Live Widget Test</h3>
        <div id="test-widget" style="min-height: 400px; border: 2px dashed #ccc; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #666;">
            Test widget will appear here
        </div>
        <button onclick="testWidget()" style="margin-top: 10px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Initialize Test Widget
        </button>
    </div>

    <script>
        function testWidget() {
            try {
                if (typeof window.AlHayatGPT === 'undefined') {
                    alert('SDK not loaded yet. Please wait a moment and try again.');
                    return;
                }
                
                const widget = AlHayatGPT.createWidget({
                    containerId: 'test-widget',
                    theme: 'auto',
                    allowGuests: true,
                    onReady: () => {
                        console.log('Test widget ready!');
                    }
                });
                
                console.log('Test widget initialized:', widget);
                
            } catch (error) {
                console.error('Test widget error:', error);
                alert('Error: ' + error.message);
            }
        }
        
        // Auto-initialize if SDK loads
        window.addEventListener('AlHayatGPTSDKReady', () => {
            console.log('SDK ready event received!');
        });
    </script>
</body>
</html> 